{% extends "::base.html.twig" %}

{% block javascripts %}

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script>
        GENTICS_Aloha_base = 'http://aloha-editor.org/aloha-0.9.3/aloha/';
        jQuery(document).ready(function() {

            // Functionality for adding items
            jQuery('#addbutton').bind('click', function() {
                var container = VIE.EntityManager.getBySubject('<http://example.net/blog/>').get('dcterms:hasPart').add([{}]);
                jQuery('[typeof="sioc:Post"][about=""]').vieSemanticAloha();
            });

            VIE.EntityManager.initializeCollection();

            VIE.EntityManager.entities.bind('add', function(model) {
                model.url = '{{ path('hello_vie_jsonld') }}';
                model.toJSON = model.toJSONLD;
            });

            // Load all RDFa entities into VIE
            VIE.RDFaEntities.getInstances();

            // Make all RDFa entities editable
            jQuery('[typeof][about]').each(function() {
                jQuery(this).vieSemanticAloha();
            });

            jQuery('#savebutton').bind('click', function() {
                // Go through all Backbone model instances loaded for the page
                VIE.EntityManager.entities.each(function(objectInstance) {
                    if (!VIE.AlohaEditable.refreshFromEditables(objectInstance)) {
                        // No changes to this object, skip
                        return true;
                    }

                    // Set the modified properties to the model instance
                    objectInstance.save(null, {
                        success: function(savedModel, response) {
                            alert(savedModel.id + " was saved, see JS console for details");
                            jQuery.each(modifiedProperties, function(propertyName, propertyValue) {
                                savedModel.editables[propertyName].setUnmodified();
                            });
                        },
                        error: function(response) {
                            console.log("Save failed");
                        }
                    });
                });
            });

            jQuery('#tweakbutton').bind('click', function() {
                VIE.EntityManager.getByType('sioc:Post')[0].set({'dcterms:title': 'Hello, world!'});
            });
        });
    </script>
    <script src="http://aloha-editor.org/aloha-0.9.3/aloha/aloha.js"></script>
    <script src="http://aloha-editor.org/aloha-0.9.3/aloha/plugins/com.gentics.aloha.plugins.Format/plugin.js"></script>
    <script src="http://aloha-editor.org/aloha-0.9.3/aloha/plugins/com.gentics.aloha.plugins.HighlightEditables/plugin.js"></script>
    <script src="/bundles/liipvie/js/vie/underscore-min.js"></script>
    <script src="/bundles/liipvie/js/vie/backbone-min.js"></script>
    <script src="/bundles/liipvie/js/vie/vie.js"></script>
    <script src="/bundles/liipvie/js/vie/vie-containermanager.js"></script>
    <script src="/bundles/liipvie/js/vie/vie-collectionmanager.js"></script>
    <script src="/bundles/liipvie/js/vie/vie-aloha.js"></script>

{% endblock %}

{% block body %}

    <h1>Vie Application</h1>

    <p>Click on the content below to edit it, then <button id="savebutton">Save</button>, <button id="addbutton">Add items</button> or <button id="tweakbutton">Change via JS</button>.</p>

    {% block content %}{% endblock %}

{% endblock %}
